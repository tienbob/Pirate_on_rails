
<div id="search-loading" class="text-center py-5" style="display: none;">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-3 text-white">Searching series...</p>
</div>

<div id="search-results">
<% if @series.any? %>
  <div class="row g-4">
    <% @series.each do |series| %>
      <% 
        # Use simpler cache key to avoid expensive MAX query on tags
        simple_cache_key = "series_card_#{series.id}_#{series.updated_at.to_i}"
      %>
      <% cache simple_cache_key do %>
        <% 
          # Create static image URL to prevent repeated backend calls
          cached_image_url = Rails.cache.fetch("series_static_url_#{series.id}_v4", expires_in: 24.hours) do
            series_static_image_url(series)
          end
        %>
        <div class="col-md-6 col-lg-4">
          <div class="series-card">
            <div class="series-card-image" 
                 style="background-image: url('<%= cached_image_url %>');"
                 role="img" 
                 aria-label="<%= series.title %>">
            </div>
            <div class="series-card-body">
              <h5 class="series-card-title"><%= series.title %></h5>
              <p class="series-card-description">
                <%= truncate(series.description, length: 120) %>
              </p>
              <% if series.tags.any? %>
                <div class="series-card-tags">
                  <% series.tags.first(3).each do |tag| %>
                    <span class="series-card-tag"><%= tag.name %></span>
                  <% end %>
                </div>
              <% end %>
              <%= link_to series_path(series), 
                  class: 'series-card-btn', 
                  data: { turbo: false } do %>
                <i class="fas fa-tv me-2"></i>Explore Series
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
  <% if @series.respond_to?(:total_pages) %>
    <div class="pagination-container">
      <%= paginate @series %>
    </div>
  <% end %>
<% else %>
  <div class="alert alert-info text-center">No series found matching your search.</div>
<% end %>
</div>
