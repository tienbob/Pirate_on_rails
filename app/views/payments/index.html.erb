<%= stylesheet_link_tag 'cinema_payments', media: 'all' %>

<% if current_user&.admin? %>
  <div class="payments-admin-section">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 col-xl-11">
          <div class="payments-dashboard-card">
            <!-- Header -->
            <div class="payments-header">
              <h1 class="payments-title">Payment Dashboard</h1>
              <p class="payments-subtitle">Admin Control Center â€¢ Financial Overview</p>
            </div>
            
            <!-- Statistics -->
            <div class="payments-stats">
              <div class="stat-card">
                <div class="stat-value"><%= @payment_stats[:total] %></div>
                <div class="stat-label">Total Payments</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" style="color: #10b981;">
                  <%= number_to_currency(@payment_stats[:completed_revenue]) %>
                </div>
                <div class="stat-label">Completed Revenue</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" style="color: #f59e0b;">
                  <%= @payment_stats[:pending_count] %>
                </div>
                <div class="stat-label">Pending Payments</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" style="color: #ef4444;">
                  <%= @payment_stats[:failed_count] %>
                </div>
                <div class="stat-label">Failed Payments</div>
              </div>
            </div>
            
            <!-- Table -->
            <div class="payments-table-container">
              <% if @payments.any? %>
                <div class="payments-table">
                  <table class=" table-hover align-middle mb-0">
                    <thead style="background-color: #1e293b; color: #f1f5f9;">
                      <tr>
                        <th><i class="fas fa-hashtag me-2"></i>ID</th>
                        <th><i class="fas fa-user me-2"></i>Customer</th>
                        <th><i class="fas fa-dollar-sign me-2"></i>Amount</th>
                        <th><i class="fas fa-check-circle me-2"></i>Status</th>
                        <th><i class="fas fa-calendar me-2"></i>Date</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% @payments.each do |payment| %>
                        <tr>
                          <td data-label="ID">
                            <span class="payment-id">#<%= payment.id %></span>
                          </td>
                          <td data-label="Customer">
                            <div class="payment-user">
                              <div class="user-avatar">
                                <%= (payment.user&.name&.first || payment.user&.email&.first || 'U').upcase %>
                              </div>
                              <div class="user-info">
                                <h6><%= payment.user&.name || 'Unknown User' %></h6>
                                <p><%= truncate(payment.user&.email || 'No email', length: 25) %></p>
                              </div>
                            </div>
                          </td>
                          <td data-label="Amount">
                            <span class="payment-amount"><%= number_to_currency(payment.amount) %></span>
                          </td>
                          <td data-label="Status">
                            <% 
                              status_class = case payment.status
                                when 'completed' then 'status-completed'
                                when 'pending' then 'status-pending'
                                when 'failed' then 'status-failed'
                                else 'status-default'
                              end
                            %>
                            <span class="status-badge <%= status_class %>">
                              <% case payment.status
                                when 'completed' %>
                                  <i class="fas fa-check me-1"></i>Completed
                                <% when 'pending' %>
                                  <i class="fas fa-clock me-1"></i>Pending
                                <% when 'failed' %>
                                  <i class="fas fa-times me-1"></i>Failed
                                <% else %>
                                  <i class="fas fa-question me-1"></i><%= payment.status.capitalize %>
                              <% end %>
                            </span>
                          </td>
                          <td data-label="Date">
                            <div class="payment-date">
                              <div><%= payment.created_at.strftime('%b %d, %Y') %></div>
                              <small style="color: #64748b;"><%= payment.created_at.strftime('%I:%M %p') %></small>
                            </div>
                          </td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              <% else %>
                <div class="empty-state">
                  <div class="empty-state-icon">
                    <i class="fas fa-receipt"></i>
                  </div>
                  <h3>No Payments Yet</h3>
                  <p>Payment records will appear here once transactions are processed.</p>
                </div>
              <% end %>
            </div>
            
            <!-- Footer -->
            <div class="payments-footer">
              <div class="payments-actions">
                <%= link_to movies_path, class: 'payment-btn payment-btn-secondary' do %>
                  <i class="fas fa-arrow-left"></i>
                  Back to Movies
                <% end %>
                
                <% if @payments.respond_to?(:current_page) %>
                  <div class="d-flex justify-content-center">
                    <%= paginate @payments %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<% else %>
  <div class="access-denied-section">
    <div class="access-denied-card">
      <div class="access-denied-icon">
        <i class="fas fa-shield-alt"></i>
      </div>
      <h2 class="access-denied-title">Access Restricted</h2>
      <p class="access-denied-text">This payment dashboard is reserved for administrators only. Please contact support if you believe this is an error.</p>
      <% if current_user && !current_user.admin? && !current_user.pro? %>
        <%= link_to upgrade_payment_path, class: 'payment-btn payment-btn-primary' do %>
          <i class="fas fa-star"></i>
          Upgrade to Pro
        <% end %>
      <% else %>
        <%= link_to series_index_path, class: 'payment-btn payment-btn-secondary' do %>
          <i class="fas fa-arrow-left"></i>
          Back to Series
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>
