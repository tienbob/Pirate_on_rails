<% content_for :head do %>
  <%= stylesheet_link_tag 'cinema_movie_form', media: 'all' %>
<% end %>

<div class="movie-form-container">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="form-card ">
          <%= form_with(model: movie, local: true, html: { multipart: true, class: 'movie-form' }) do |form| %>
            <% if movie.errors.any? %>
              <div class="error-alert">
                <h4>
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  <%= pluralize(movie.errors.count, "error") %> prohibited this movie from being saved:
                </h4>
                <ul>
                  <% movie.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <div class="form-group">
              <%= form.label :title, class: 'form-label' do %>
                <i class="fas fa-film me-2"></i>Movie Title
              <% end %>
              <%= form.text_field :title, 
                  class: 'form-control-modern', 
                  placeholder: 'Enter the movie title...',
                  required: true %>
            </div>

            <div class="form-group">
              <%= form.label :description, class: 'form-label' do %>
                <i class="fas fa-align-left me-2"></i>Description
              <% end %>
              <%= form.text_area :description, 
                  class: 'form-control-modern form-textarea', 
                  placeholder: 'Describe the movie plot, themes, and key details...',
                  required: true %>
            </div>

            <div class="form-group">
              <%= form.label :release_date, class: 'form-label' do %>
                <i class="fas fa-calendar-alt me-2"></i>Release Date
              <% end %>
              <%= form.date_field :release_date, 
                  class: 'form-control-modern' %>
            </div>

            <div class="form-group">
              <div class="form-check-modern">
                <%= form.check_box :is_pro, class: 'form-check-input-modern' %>
                <%= form.label :is_pro, class: 'form-check-label-modern' do %>
                  <i class="fas fa-crown me-2"></i>Premium Content (Pro Only)
                <% end %>
              </div>
            </div>

            <div class="form-group" data-controller="file-upload">
              <%= form.label :video_file, class: 'form-label' do %>
                <i class="fas fa-video me-2"></i>Video File
              <% end %>
              <div class="file-input-container">
                <%= form.file_field :video_file, 
                    accept: "video/*",
                    class: 'form-control',
                    data: { file_upload_target: "input" } %>
                <div class="file-input-text" data-file-upload-target="text">
                  <i class="fas fa-cloud-upload-alt mb-2" style="font-size: 2rem; color: #64748b;"></i>
                  <p>Click to upload video or drag and drop</p>
                  <p style="font-size: 0.75rem;">Supported formats: MP4, AVI, MOV</p>
                </div>
              </div>
              <div data-file-upload-target="preview"></div>
            </div>

            <%= form.hidden_field :series_id, value: movie.series_id %>

            <div class="form-group" data-controller="movie">
              <%= form.label :tags, class: 'form-label' do %>
                <i class="fas fa-tags me-2"></i>Genres & Tags
              <% end %>
              <div class="tags-grid" data-movie-target="tagSelect">
                <% selected_tags = (movie.tags + (movie.series&.tags || [])).uniq %>
                <% Tag.all.each do |tag| %>
                  <div class="tag-checkbox">
                    <%= check_box_tag "movie[tag_ids][]", 
                        tag.id, 
                        selected_tags.include?(tag), 
                        id: "tag_#{tag.id}" %>
                    <label for="tag_<%= tag.id %>"><%= tag.name %></label>
                  </div>
                <% end %>
              </div>
              <input type="hidden" data-movie-target="selectedTags" />
            </div>

            <div class="form-group">
              <%= form.submit movie.persisted? ? 'Update Movie' : 'Create Movie', 
                  class: 'submit-button' %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
